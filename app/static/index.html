<!DOCTYPE html>
<html>
    <head>
        <title>SFpark Demo</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <!-- Ext resources -->
        <link rel="stylesheet" type="text/css" href="externals/ext/resources/css/ext-all.css">
        <link rel="stylesheet" type="text/css" href="externals/ext/resources/css/xtheme-gray.css">
        <script type="text/javascript" src="externals/ext/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="externals/ext/ext-all.js"></script>

        <link rel="shortcut icon" href="http://sfpark.org/wp-content/themes/sfpark/images/favicon.png">
        <link rel="stylesheet" href="http://sfpark.org/wp-content/themes/sfpark/style.css" type="text/css" media="screen">
        <link rel="stylesheet" href="http://sfpark.org/wp-content/themes/sfpark/css/960.css" type="text/css" media="screen">
        <link rel="stylesheet" href="http://sfpark.org/wp-content/themes/sfpark/css/jqzoom.css" type="text/css" media="screen">
        <link rel="stylesheet" href="http://sfpark.org/wp-content/plugins/fancybox-for-wordpress/css/fancybox.css" type="text/css" media="screen">
        
        <!-- OpenLayers resources -->
        <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css">
        <script type="text/javascript" src="script/OpenLayers.js"></script>

        <!-- GeoExt resources -->
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/popup.css">
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/layerlegend.css">
        <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/gxtheme-gray.css">
        <script type="text/javascript" src="script/GeoExt.js"></script> 

        <!-- gxp resources -->
        <link rel="stylesheet" type="text/css" href="externals/gxp/src/theme/all.css">
        <script type="text/javascript" src="script/gxp.js"></script> 
        
        <!-- app resources -->
        <link rel="stylesheet" type="text/css" href="theme/app/style.css">
        <!--[if IE]><link rel="stylesheet" type="text/css" href="theme/app/ie.css"/><![endif]-->
        <script type="text/javascript" src="script/app.js"></script>
        
        <style>
            div#fancy_inner {border-color:#BBBBBB}
            div#fancy_close {right:-15px;top:-12px}
            div#fancy_bg {background-color:#FFFFFF}
            .panel>.content {
                overflow: auto;
            }
        </style>

        <script type="text/javascript">

            Ext.QuickTips.init();
            Ext.BLANK_IMAGE_URL = "theme/app/img/blank.gif";
            OpenLayers.DOTS_PER_INCH = 25.4 / 0.28;
            OpenLayers.ImgPath = "externals/openlayers/img/";
            OpenLayers.ProxyHost = "proxy/?url=";
            OpenLayers.Layer.WMS.prototype.DEFAULT_PARAMS.transparent = true;

            Ext.ns("app.constants");
            app.constants.AVAILABILITY = 0;
            app.constants.PRICING = 1;

            var viewer = new gxp.Viewer({
                mode: app.constants.AVAILABILITY,
                portalConfig: {renderTo: 'map', border: false, width: 940, height: 400},
                portalItems: [{
                    layout:'hbox',
                    border: false,
                    region: 'center',
                    layoutConfig: {
                        align : 'stretch',
                        pack  : 'start'
                    },
                    items: [
                        {
                            layout: 'vbox', 
                            border: false, 
                            items: [
                                {
                                    layout: "hbox",
                                    layoutConfig: {
                                        align: "middle"
                                    },
                                    defaults: {
                                        cls: 'search', 
                                        border: false,
                                        height: 35
                                    },
                                    items: [
                                        {
                                            width: 90,
                                            flex: 1,
                                            bodyCfg: {tag: 'div', cls: 'findHeader', html: 'Find parking: '}
                                        }, {
                                            width: 260,
                                            bodyCfg: {tag: 'div'},
                                            id: "geocoder"
                                        }, {
                                            flex: 1,
                                            xtype: "button",
                                            text: "Availability",
                                            handler: function() {
                                                viewer.mode = app.constants.AVAILABILITY;
                                                var map = viewer.mapPanel.map;
                                                for (var i=0,ii=map.layers.length;i<ii;++i) {
                                                    var layer = map.layers[i];
                                                    if (layer instanceof OpenLayers.Layer.WMS) {
                                                        if (layer.params.LAYERS === "sfpark:BLOCKFACE_AVAILABILITY") {
                                                            layer.mergeNewParams({'STYLES': 'BLOCKFACE_AVAIL_THRESHOLD'});
                                                        }
                                                        if (layer.params.LAYERS === "sfpark:OSP_AVAILABILITY") {
                                                            layer.mergeNewParams({'STYLES': 'OSP_AVAIL_THRESHOLD'});
                                                        }
                                                    }
                                                }
                                            } 
                                        }, {
                                            flex: 1,
                                            xtype: "button",
                                            text: "Pricing",
                                            handler: function() {
                                                viewer.mode = app.constants.PRICING;
                                                var map = viewer.mapPanel.map;
                                                for (var i=0,ii=map.layers.length;i<ii;++i) {
                                                    var layer = map.layers[i];
                                                    if (layer instanceof OpenLayers.Layer.WMS) {
                                                        if (layer.params.LAYERS === "sfpark:BLOCKFACE_AVAILABILITY") {
                                                            layer.mergeNewParams({'STYLES': 'BLOCKFACE_RATE_THRESHOLD'});
                                                        }
                                                        if (layer.params.LAYERS === "sfpark:OSP_AVAILABILITY") {
                                                            layer.mergeNewParams({'STYLES': 'OSP_RATE_THRESHOLD'});
                                                        }
                                                    }
                                                }
                                            }
                                        }, {
                                            width: 200,
                                            bodyCfg: {tag: "div", cls: "availability-legend"},
                                            id: "legend"
                                        }, {
                                            flex: 1,
                                            xtype: "button",
                                            text: "refresh"
                                        }
                                    ],
                                    height: 35, 
                                    width: 900, 
                                    border: false
                                }, 
                                "map"
                            ]
                        }
                    ]
               }],
               mapItems: [{
                   xtype: "gx_zoomslider",
                   vertical: true,
                   height: 100
               }],
               sources: {
                   local: {
                       ptype: "gxp_wmssource",
                       url: "/geoserver/ows",
                       title: "Local GeoServer",
                       version: "1.1.1"
                   },
                   google: {
                       ptype: "gxp_googlesource"
                   }
               },
               tools: [
                   {
                       ptype: "app_wmsgetfeatureinfo",
                       actionTarget: null
                   }, {
                       ptype: "gxp_googlegeocoder",
                       outputTarget: "geocoder",
                       outputConfig: {
                           width: 250,
                           bounds: [-122.444, 37.752, -122.388, 37.809],
                           emptyText: "Type an address, zip code, or intersection",
                           listEmptyText: "- no matches -"
                       }
                   }
               ],
               map: {
                   id: "map", flex: 1, width: 900,
                   border: false,
                   projection: "EPSG:900913",
                   units: "m",
                   numZoomLevels: 21,
                   maxResolution: 156543.03390625,
                   maxExtent: [
                       -20037508.34, -20037508.34,
                       20037508.34, 20037508.34
                   ],
                   extent: [-13650159, 4534735, -13609227, 4554724],
                   layers: [{
                       source: "google",
                       title: "Road Map",
                       name: "ROADMAP",
                       group: "background",
                       visibility: true
                   }, {
                       source: "google",
                       title: "Hybrid Map",
                       name: "HYBRID",
                       group: "background",
                       visibility: false
                   }, {
                       source: "google",
                       title: "Satellite Map",
                       name: "SATELLITE",
                       group: "background",
                       visibility: false
                   }, {
                       source: "google",
                       title: "Terrain Map",
                       name: "TERRAIN",
                       group: "background",
                       visibility: false
                   }, {
                       source: "local",
                       name: "sfpark:BLOCKFACE_AVAILABILITY",
                       styles: "BLOCKFACE_AVAIL_THRESHOLD",
                       visibility: true
                   }, {
                       source: "local",
                       name: "sfpark:OSP_AVAILABILITY",
                       styles: "OSP_AVAIL_THRESHOLD",
                       visibility: true
                   }],
                   center: [-13629218, 4545403],
                   zoom: 13
               }
           });

        </script>

    </head>
    <body class="home page page-id-19 page-parent page-template page-template-page-home-php">
        <p>&nbsp;</p>
        <div class="outer_bg">
            <div class="outer clearfix container_12">
                <div class="header grid_12">
                    <a title="Visit the Homepage" id="logo" href="http://sfpark.org"><img src="http://sfpark.org/wp-content/themes/sfpark/images/logo.png" alt="SFpark Logo" /></a>
                    <div class="menu"></div>
                </div>
                <div class="slider grid_12">
                    <div id="chained" class="scrollable">    
                        <div class="navi"></div> 
                        <div id="items">
                            <div class="panel">
                                <div id="map"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="grid_12">
                    <div id="content" class="grid_8 alpha omega">
                        <div id="text-3" class="home_widget">
                            <p>&nbsp;</p>
                            <h3>Details</h3>            
                            <div class="textwidget">
                                <p>
                                    TODO: Describe what the map does here.
                                </p>
                                <p>
                                    This map is a rough demonstration of map feature selection by <a href="http://opengeo.org/">OpenGeo</a>.
                                    The data used is a limited set and is meant for demonstration purposes only.
                                </p>
                                <a title="Learn More About OpenGeo" class="blue_btn" href="http://opengeo.org/">Learn More</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
